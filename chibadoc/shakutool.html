
<!-- saved from url=(0067)file:///Users/unhp/Downloads/Shakuhachi%20and%20xiao/shakutool.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
    <link href="file:///Users/unhp/Downloads/Shakuhachi%20and%20xiao/shakutool_shakuhachi%20calculator%20edit%20length_files/css" rel="stylesheet" type="text/css">
    <link href="file:///Users/unhp/Downloads/Shakuhachi%20and%20xiao/shakutool_shakuhachi%20calculator%20edit%20length_files/css(1)" rel="stylesheet" type="text/css">
    <style type="text/css">
        h1, h2 {
            text-align: center;
            font-family: Ribeye Marrow;
        }

        p, th, td, input {
            font-family: Linden Hill;
            font-size: 14pt;
        }
	p { text-align: center; }
        .error {
            color: red;
        }
        input#flute_length_text, input#hole_diameter_text, input#bore_diameter_text, input#ergonomic_limit_text {
            width: 3.2em;
        }
        input#wall_thickness_text {
            width: 4em;
        }

        table {
            margin-left: auto;
            margin-right: auto;
            width: 500px;
        }

        table th {
            text-align: right;
        }

        table#output {
            border: 1px solid grey;
            padding: 10px;
        }

        body {
            width: 650px;
            margin-left: auto;
            margin-right: auto;
        }

        div.fb-comments {
            width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
    </style>
</head>
<body>
<h1>Shakuhachi Tool</h1>
<p>By Jeremy Bornstein, based on algorithms by Nelson Zink. Tran Nghia extended Flute length to 1300 for 3.6 to above flute<!-- documented <a href="http://www.navaching.com/shaku/ergon.html">here</a>-->. Thanks Nelson!</p>

<table id="parameters">
    <tbody>
        <tr>
            <th>Flute Length</th>
            <td><input type="range" id="flute_length_slider" onchange="change_flute_length()" min="30" max="1300"> <input id="flute_length_text" onchange="change_flute_length_text()">mm</td>
        </tr>
        <tr>
            <th>Hole Diameter</th>
            <td><input type="range" id="hole_diameter_slider" onchange="change_hole_diameter()" min="5" max="30"> <input id="hole_diameter_text" onchange="change_hole_diameter_text()">mm</td>
        </tr>
        <tr>
            <th>Bore Diameter</th>
            <td><input type="range" id="bore_diameter_slider" step="0.5" onchange="change_bore_diameter()" min="10" max="100"> <input id="bore_diameter_text" onchange="change_bore_diameter_text()">mm</td>
        </tr>
        <tr>
            <th>Wall Thickness</th>
            <td><input type="range" id="wall_thickness_slider" step="0.125" onchange="change_wall_thickness()" min="1" max="10"> <input id="wall_thickness_text" onchange="change_wall_thickness_text()">mm</td>
        </tr>
        <tr>
            <th>Ergonomic Limit</th>
            <td><input type="range" id="ergonomic_limit_slider" onchange="change_ergonomic_limit()" min="10" max="180"> <input id="ergonomic_limit_text" onchange="change_ergonomic_limit_text()">mm</td>
        </tr>

    </tbody>
</table>
<table id="output">
    <tbody><tr><th>Base Frequency</th> <td id="base_frequency">240.8 (B)</td></tr>
    <tr><th>Aspect Ratio</th> <td id="aspect_ratio">31.71</td></tr>
    <tr><th>Hole #5</th> <td id="hole_5" class="">280mm from top of flute</td></tr>
    <tr><th>Hole #4</th> <td id="hole_4" class="">320mm from top of flute</td></tr>
    <tr><th>Hole #3</th> <td id="hole_3" class="">394mm (380mm) from top of flute</td></tr>
    <tr><th>Hole #2</th> <td id="hole_2" class="">450mm from top of flute</td></tr>
    <tr><th>Hole #1</th> <td id="hole_1" class="">512mm (510mm) from top of flute</td></tr>
    <tr><th>Span 5-4</th> <td id="span_5_4">40mm</td></tr>
    <tr><th>Span 4-3</th> <td id="span_4_3">74mm</td></tr>
    <tr><th>Span 2-1</th> <td id="span_2_1">62mm</td></tr>
</tbody></table>
<!--
<h2>Comments</h2>
<div class="fb-comments" data-href="http://nghiason.vn/shakutool.html" data-num-posts="5" data-width="500"></div>
<div id="fb-root"></div>
-->

<script>
<!--
(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=134901139982276";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
-->
function ready (f) {
    if (document.readyState != 'loading') { f (); return; }
    if (document.addEventListener) { window.addEventListener ("load", f, false ); return; }
    window.attachEvent ( "onload", f );
}

var FLUTE_LENGTH_SLIDER;
var FLUTE_LENGTH_TEXT;
var FLUTE_LENGTH_MIN = 30;
var FLUTE_LENGTH_MAX = 1300;
var FLUTE_LENGTH_DEFAULT = 650;

var HOLE_DIAMETER_SLIDER;
var HOLE_DIAMETER_TEXT;
var HOLE_DIAMETER_MIN = 5;
var HOLE_DIAMETER_MAX = 30;
var HOLE_DIAMETER_DEFAULT=10;

var BORE_DIAMETER_SLIDER;
var BORE_DIAMETER_TEXT;
var BORE_DIAMETER_MIN = 10;
var BORE_DIAMETER_MAX = 100;
var BORE_DIAMETER_DEFAULT = 20.5;

var WALL_THICKNESS_SLIDER;
var WALL_THICKNESS_TEXT;
var WALL_THICKNESS_MIN = 1;
var WALL_THICKNESS_MAX = 10;
var WALL_THICKNESS_DEFAULT = 3 * 1.125;

var ERGONOMIC_LIMIT_SLIDER;
var ERGONOMIC_LIMIT_TEXT;
var ERGONOMIC_LIMIT_MIN = 10;
var ERGONOMIC_LIMIT_MAX = 180;
var ERGONOMIC_LIMIT_DEFAULT = 60;

var NOTE_NAME;

function change_flute_length () {
    FLUTE_LENGTH_TEXT.value = FLUTE_LENGTH_SLIDER.value;
    NOTE_NAME = note_name (156521 / FLUTE_LENGTH_SLIDER.value);
    calculate ();
}
function change_flute_length_text () {
    var value = parseFloat (FLUTE_LENGTH_TEXT.value);
    value = Math.max (Math.min (value, FLUTE_LENGTH_MAX), FLUTE_LENGTH_MIN);
    FLUTE_LENGTH_TEXT.value = value;
    FLUTE_LENGTH_SLIDER.value = value;
    NOTE_NAME = note_name (156521 / value);
    calculate ();
}

function change_hole_diameter () {
    HOLE_DIAMETER_TEXT.value = HOLE_DIAMETER_SLIDER.value;
    calculate ();
}
function change_hole_diameter_text () {
    var value = parseFloat (HOLE_DIAMETER_TEXT.value);
    value = Math.max (Math.min (value, HOLE_DIAMETER_MAX), HOLE_DIAMETER_MIN);
    HOLE_DIAMETER_TEXT.value = value;
    HOLE_DIAMETER_SLIDER.value = value;
    calculate ();
}

function change_bore_diameter () {
    BORE_DIAMETER_TEXT.value = BORE_DIAMETER_SLIDER.value;
    calculate ();
}
function change_bore_diameter_text () {
    var value = parseFloat (BORE_DIAMETER_TEXT.value);
    value = Math.max (Math.min (value, BORE_DIAMETER_MAX), BORE_DIAMETER_MIN);
    BORE_DIAMETER_TEXT.value = value;
    BORE_DIAMETER_SLIDER.value = value;
    calculate ();
}

function change_wall_thickness () {
    WALL_THICKNESS_TEXT.value = WALL_THICKNESS_SLIDER.value;
    calculate ();
}
function change_wall_thickness_text () {
    var value = parseFloat (WALL_THICKNESS_TEXT.value);
    value = Math.max (Math.min (value, WALL_THICKNESS_MAX), WALL_THICKNESS_MIN);
    WALL_THICKNESS_TEXT.value = value;
    WALL_THICKNESS_SLIDER.value = value;
    calculate ();
}

function change_ergonomic_limit () {
    ERGONOMIC_LIMIT_TEXT.value = ERGONOMIC_LIMIT_SLIDER.value;
    calculate ();
}
function change_ergonomic_limit_text () {
    var value = parseFloat (ERGONOMIC_LIMIT_TEXT.value);
    value = Math.max (Math.min (value, ERGONOMIC_LIMIT_MAX), ERGONOMIC_LIMIT_MIN);
    ERGONOMIC_LIMIT_TEXT.value = value;
    ERGONOMIC_LIMIT_SLIDER.value = value;
    calculate ();
}

function note_name (hertz) {
    // thanks to http://www.phy.mtu.edu/~suits/NoteFreqCalcs.html !
    var base_frequency = 440;
    var note_names = ['A', 'A#', 'B', 'C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#'];
    var A = Math.pow (2, 1/12);
    var value_low = -50;
    var value_high = 50;

    function name_for_note_by_semitones (count) {
        var mod = count % 12;
        if (mod < 0) return note_names[12+mod];
        else return note_names[mod];
    }

    var tries = 0;
    while (true) {
        var middle = Math.round ((value_high - value_low) / 2 + value_low);
        var freq = base_frequency * Math.pow (A, middle);

        if (freq < hertz) value_low = middle;
        else if (freq > hertz) value_high = middle;

        if (value_low + 1 == value_high) {
            var diff_low = hertz - base_frequency * Math.pow (A, value_low);
            var diff_high = base_frequency * Math.pow (A, value_high) - hertz;
            if (diff_low < diff_high) {
                return name_for_note_by_semitones(value_low);
            } else {
                return name_for_note_by_semitones(value_high);
            }
        }

        tries += 1;
        if (tries > 16) break;
    }

    return '?'
}


function calculate () {
    // NOTE: variable names preserved from Nelson's original. I haven't actually attempted to break this down at all, just to duplicate the original results.

    var TL = parseFloat (FLUTE_LENGTH_SLIDER.value);
    var Dh = parseFloat (HOLE_DIAMETER_SLIDER.value);
    var BaseNote = 156521.0 / TL;
    var Db = parseFloat (BORE_DIAMETER_SLIDER.value);
    var Wt = parseFloat (WALL_THICKNESS_SLIDER.value);
    var Te = Wt + (0.75 * Dh);
    var BigNum = 165674
    var TubeLength = BigNum / BaseNote;
    var MEL = TubeLength - (0.3 * Db) - TL;
    var IInch = TL / 25.4;
    var AspectRatio = TL/Db;

    var LastLength = TubeLength;
    var temp = 0;
    var HoleLocations = [];
    var Interval = [3, 2, 2, 3, 2];

    for (var zz = 0; zz < Interval.length; zz++) {
        var thisInterval = Interval[zz];
        temp += thisInterval;
        var Hz = BaseNote * Math.pow (2,(temp/12.0));
        var NewLength = BigNum / Hz;
        var S = (LastLength - NewLength) / 2.0;
        CF = S * (  (     Math.pow(((   (      (Te/S)*  Math.pow(Db/Dh,2)     )   *2)+1),0.5)    )   - 1);
        var HoleLocation = Math.round (NewLength-MEL-CF);
        HoleLocations.push (HoleLocation);
        LastLength = NewLength + CF;
    }

    HoleLocations = HoleLocations.reverse ();
    var AlternateHoleLocations = [null, null, null, null, null];

    var ErgoSpan = parseFloat (ERGONOMIC_LIMIT_SLIDER.value);
    var ThumbS = HoleLocations[1] - HoleLocations[0];
    var TopS = HoleLocations[2] - HoleLocations[1];
    var BottomS = HoleLocations[4] - HoleLocations[3];

    if (ThumbS > (ErgoSpan * 2.0 / 3.0)) AlternateHoleLocations[0] = HoleLocations[1] + Math.round (ErgoSpan * 2.0 / 3.0);
    if (TopS > ErgoSpan) AlternateHoleLocations[2] = HoleLocations[1] + ErgoSpan;
    if (BottomS > ErgoSpan) AlternateHoleLocations[4] = HoleLocations[3] + ErgoSpan;

    document.getElementById ('base_frequency').innerHTML = '' + (Math.round (BaseNote*100) / 100) + ' (' + NOTE_NAME + ')';
    document.getElementById ('aspect_ratio').innerHTML = Math.round (AspectRatio*100) / 100;

    document.getElementById ('hole_5').innerHTML = HoleLocations[0] + 'mm' + (AlternateHoleLocations[0] ? ' (' + AlternateHoleLocations[0] + 'mm)' : '') + ' from top of flute';
    document.getElementById ('hole_4').innerHTML = HoleLocations[1] + 'mm from top of flute';
    document.getElementById ('hole_3').innerHTML = HoleLocations[2] + 'mm' + (AlternateHoleLocations[2] ? ' (' + AlternateHoleLocations[2] + 'mm)' : '') + ' from top of flute';
    document.getElementById ('hole_2').innerHTML = HoleLocations[3] + 'mm from top of flute';
    document.getElementById ('hole_1').innerHTML = HoleLocations[4] + 'mm' + (AlternateHoleLocations[4] ? ' (' + AlternateHoleLocations[4] + 'mm)' : '') + ' from top of flute';

    document.getElementById ('hole_5').className = HoleLocations[0] <= 0 ? 'error' : '';
    document.getElementById ('hole_4').className = HoleLocations[1] <= 0 ? 'error' : '';
    document.getElementById ('hole_3').className = HoleLocations[2] <= 0 ? 'error' : '';
    document.getElementById ('hole_2').className = HoleLocations[3] <= 0 ? 'error' : '';
    document.getElementById ('hole_1').className = HoleLocations[4] <= 0 ? 'error' : '';

    document.getElementById ('span_5_4').innerHTML = ThumbS + 'mm';
    document.getElementById ('span_4_3').innerHTML = TopS + 'mm';
    document.getElementById ('span_2_1').innerHTML = BottomS + 'mm';
}

ready (function () {
    FLUTE_LENGTH_SLIDER = document.getElementById ('flute_length_slider');
    FLUTE_LENGTH_TEXT = document.getElementById ('flute_length_text');
    FLUTE_LENGTH_SLIDER.min = FLUTE_LENGTH_MIN;
    FLUTE_LENGTH_SLIDER.max = FLUTE_LENGTH_MAX;
    FLUTE_LENGTH_SLIDER.value = FLUTE_LENGTH_DEFAULT;
    FLUTE_LENGTH_TEXT.value = FLUTE_LENGTH_DEFAULT;

    NOTE_NAME = note_name (156521 / FLUTE_LENGTH_DEFAULT);

    HOLE_DIAMETER_SLIDER = document.getElementById ('hole_diameter_slider');
    HOLE_DIAMETER_TEXT = document.getElementById ('hole_diameter_text');
    HOLE_DIAMETER_SLIDER.min = HOLE_DIAMETER_MIN;
    HOLE_DIAMETER_SLIDER.max = HOLE_DIAMETER_MAX;
    HOLE_DIAMETER_SLIDER.value = HOLE_DIAMETER_DEFAULT;
    HOLE_DIAMETER_TEXT.value = HOLE_DIAMETER_DEFAULT;

    BORE_DIAMETER_SLIDER = document.getElementById ('bore_diameter_slider');
    BORE_DIAMETER_TEXT = document.getElementById ('bore_diameter_text');
    BORE_DIAMETER_SLIDER.min = BORE_DIAMETER_MIN;
    BORE_DIAMETER_SLIDER.max = BORE_DIAMETER_MAX;
    BORE_DIAMETER_SLIDER.value = BORE_DIAMETER_DEFAULT;
    BORE_DIAMETER_TEXT.value = BORE_DIAMETER_DEFAULT;

    WALL_THICKNESS_SLIDER = document.getElementById ('wall_thickness_slider');
    WALL_THICKNESS_TEXT = document.getElementById ('wall_thickness_text');
    WALL_THICKNESS_SLIDER.min = WALL_THICKNESS_MIN;
    WALL_THICKNESS_SLIDER.max = WALL_THICKNESS_MAX;
    WALL_THICKNESS_SLIDER.value = WALL_THICKNESS_DEFAULT;
    WALL_THICKNESS_TEXT.value = WALL_THICKNESS_DEFAULT;

    ERGONOMIC_LIMIT_SLIDER = document.getElementById ('ergonomic_limit_slider');
    ERGONOMIC_LIMIT_TEXT = document.getElementById ('ergonomic_limit_text');
    ERGONOMIC_LIMIT_SLIDER.min = ERGONOMIC_LIMIT_MIN;
    ERGONOMIC_LIMIT_SLIDER.max = ERGONOMIC_LIMIT_MAX;
    ERGONOMIC_LIMIT_SLIDER.value = ERGONOMIC_LIMIT_DEFAULT;
    ERGONOMIC_LIMIT_TEXT.value = ERGONOMIC_LIMIT_DEFAULT;

    calculate ();
});
</script>

</body></html>